#!/usr/bin/env bash
# This script configures an Ubuntu server to set specific DNS resolutions.

# Define the hosts file path
hosts_file="/etc/hosts"

# Ensure script is executed with root privileges
if [[ $EUID -ne 0 ]]; then
    echo "This script must be run as root" 
    exit 1
fi

# Add custom DNS resolutions to hosts file
echo "127.0.0.2 localhost" >> "$hosts_file"
echo "8.8.8.8 facebook.com" >> "$hosts_file"

# Verify if entries are added successfully
grep -E "(127\.0\.0\.2.*localhost)|(8\.8\.8\.8.*facebook\.com)" "$hosts_file" > /dev/null

if [[ $? -eq 0 ]]; then
    echo "DNS resolutions configured successfully"
else
    echo "Failed to configure DNS resolutions"
    exit 1
fi

# Restart networking service to apply changes
systemctl restart systemd-networkd

exit 0

